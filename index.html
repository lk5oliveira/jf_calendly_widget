<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendly Widget</title>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>
<body>
    <input type="text" id='userInput' hidden>
    <div class="calendly-inline-widget" data-url="https://calendly.com/lucasoliveira-hd7e/30min" style="min-width:320px;height:700px;"></div>
    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
</body>
<script>

    let event;
    let iframeContainer = document.querySelector('.calendly-inline-widget');

    JFCustomWidget.subscribe("ready", function(){


        function isCalendlyEvent(e) {
            return e.data.event &&
                e.data.event.indexOf('calendly') === 0;
        };

        window.addEventListener(
            'message',
            function(e) {
                if (isCalendlyEvent(e)) {
                    event = e.data;
                    console.log(event.event);
                    
                    if(event.event == 'calendly.event_scheduled') {
                        document.getElementById('userInput').value = 'booked';
                        iframeContainer.style.height = '490px';
                        JFCustomWidget.requestFrameResize({ height: 420 });
                    }
                }
            }
        );

        JFCustomWidget.subscribe("submit", function(){
            let msg = {};
            if(event.event != 'calendly.event_scheduled') {
                msg = { valid: false };
            } else {
                msg = {
                    valid: true,
                    value: document.getElementById('userInput').value
                };
            }

            // send value to JotForm
            JFCustomWidget.sendSubmit(msg);
        });
    });

</script>
</html>